---
title: 函数执行-作用域链-面试题-内存管理
date: 2022-12-26 21:02:53
permalink: /pages/c10566/
categories:
  - 《深入JavaScript高级》笔记
tags:
  -
author:
  name: Q7Long
  link: https://github.com/Q7Long
---

# 03 函数执行-作用域链-面试题-内存管理

### _全局代码执行过程(函数)_

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image1.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image2.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image3.png)

### ⭐⭐⭐ 为什么函数可以在声明前使用？

⭐⭐**编译过程**

- **变量**代码在编译的时候，name 普通变量会先被赋值为 undefined，
- **函数**执行到函数的时候，不会被执行，然后会在全局对象 globalObject 里面添加 foo 属性，但是这个属性的值并不是 undefined，它会在内存里面帮我们创建一个对象叫做函数对象
- **VO 是全局作用域**
- **GO 是全局对象**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image4.png)

⭐⭐**执行函数过程**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image5.png)

### _作用域链_

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image6.png)

- ⭐**函数嵌套的情况** **函数在不被执行的时候，是不会被编译的，只会被预编译，预编译不会编译函数里面的内容**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image7.png)

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image8.png)

### 函数调用函数执行过程(函数执行过程中，只会找当前作用域和父级作用域里面的变量)

⭐**因为父级作用域在编译的时候就已经被确定了，所以打印的时候的作用域是被定义时候的作用域，即编译时候的作用域**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image9.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image10.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image11.png)

### (理解)变量环境和记录

- 其实上面的知识点都是基于早期 ECMA 的标准规范

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image12.png)

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image13.png)

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image14.png)

**环境记录不再局限于用对象去实现，而是可以使用任何方式，比如 Map**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image15.png)

### 作用域提升面试题![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image16.png)

**第一题**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image17.png)

- **第二题**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image18.png)

- **第三题**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image19.png)

- ⭐⭐⭐**第四题**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image20.png)

- ⭐⭐⭐**第五题\*\***(第二个正常来说，如果是在浏览器里面执行的话，只打印 a is not defined 报错之后不再向下执行)\*\*

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image21.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image22.png)

### 认识内存管理

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image23.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image24.png)

- **JS 的内存管理** JavaScript 会在我们定义变量的时候为我们分配内存

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image25.png)

- **JS 的垃圾回收机制(Garbage Collection GC)**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image26.png)

- 但是这里就出现了另外一个关键的问题**，\*\***GC 怎么知道哪些对象是不再使用的呢？(GC 算法)\*\*

- - **常见的第一种 GC 算法\*\***-\***\*引用计数**

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image27.png)

**当 retain count 为 0 的时候，那么就代表不再引用它，就会把这块内存地址给它回收掉**

- - 引用计数存在一个很大的弊端**:\*\***循环引用\*\*

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image28.png)

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image29.png)

- - **第二种 GC 算法--\*\***标记清除(可以有效解决循环引用带来的问题)\*\*

![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image30.png)
![img](http://www.zhangqilong.cn/img/qlBlog_images/%E6%B7%B1%E5%85%A5JavaScript%E9%AB%98%E7%BA%A7/03.%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C-%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-%E9%9D%A2%E8%AF%95%E9%A2%98-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/image31.png)

- **内存泄漏就是该释放的内存没有被释放掉**
